<h2 mat-dialog-title>Edit Post</h2>
<mat-dialog-content>
  <form [formGroup]="postForm" class="post-form">
    <!-- Title Field -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Post Title</mat-label>
      <input matInput
             formControlName="title"
             placeholder="Enter post title..."
             maxlength="200">
      <mat-hint>{{ postForm.get('title')?.value?.length || 0 }} / 200</mat-hint>
      <mat-error *ngIf="postForm.get('title')?.hasError('required')">
        Title is required
      </mat-error>
    </mat-form-field>

    <!-- Quill Editor for Description -->
    <div class="editor-label">
      <label>Post Description</label>
    </div>
    <textarea
      formControlName="description"
      placeholder="Write your post description here..."
      rows="4"
      class="description-textarea"></textarea>
    <mat-error *ngIf="postForm.get('description')?.hasError('required')" class="error-text">
      Description is required
    </mat-error>

    <!-- Media Upload Section -->
    <div class="media-upload-section">
      <label for="media-input" class="media-label" [class.disabled]="!canAddMore()">
        <mat-icon>add_photo_alternate</mat-icon>
        <span>Add More Media (Max 4)</span>
      </label>
      <input #fileInput
             type="file"
             id="media-input"
             accept="image/*,video/*"
             multiple
             [disabled]="!canAddMore()"
             (change)="onMediaFileSelected($event)"
             hidden>
      <small class="media-hint">{{ getTotalMediaCount() }} / 4 media files</small>
    </div>

    <!-- Uploaded Media Preview (Existing) -->
    <div class="media-gallery" *ngIf="uploadedMediaUrls.length > 0">
      <h4>Current Media</h4>
      <div class="preview-grid">
        <div class="preview-item" *ngFor="let url of uploadedMediaUrls; let i = index">
          <img *ngIf="uploadedMediaTypes[i] === 'image'" [src]="url" alt="Uploaded" class="preview-image">
          <video *ngIf="uploadedMediaTypes[i] === 'video'" [src]="url" controls class="preview-video"></video>
          <button mat-icon-button type="button" (click)="removeMedia(i, true)" class="remove-btn">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Selected Files Preview -->
    <div class="media-gallery" *ngIf="mediaPreviews.length > 0">
      <h4>New Media (Not Yet Uploaded)</h4>
      <div class="preview-grid">
        <div class="preview-item" *ngFor="let preview of mediaPreviews; let i = index">
          <img *ngIf="mediaTypes[i] === 'image'" [src]="preview" alt="Preview" class="preview-image">
          <video *ngIf="mediaTypes[i] === 'video'" [src]="preview" controls class="preview-video"></video>
          <button mat-icon-button type="button" (click)="removeMedia(i, false)" class="remove-btn">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
      <small class="upload-hint">New media will be uploaded when you save the post</small>
    </div>

    <!-- Clear All Button -->
    <button mat-button type="button" (click)="clearAllMedia()" *ngIf="getTotalMediaCount() > 0" class="clear-all-btn">
      <mat-icon>clear_all</mat-icon>
      Clear All Media
    </button>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isLoading || isUploading">Cancel</button>
  <button mat-raised-button color="primary" (click)="onSubmit()"
          [disabled]="isLoading || isUploading || postForm.invalid">
    <mat-spinner diameter="20" *ngIf="isLoading || isUploading"></mat-spinner>
    <span *ngIf="!isLoading && !isUploading">Save Changes</span>
    <span *ngIf="isUploading">Uploading Media...</span>
    <span *ngIf="isLoading && !isUploading">Saving...</span>
  </button>
</mat-dialog-actions>
