<div class="admin-container">
  <h1>Admin Panel</h1>

  <mat-tab-group>
    <mat-tab label="Users">
      <div class="tab-content">
        <mat-spinner *ngIf="isLoadingUsers"></mat-spinner>
        <table mat-table [dataSource]="users" *ngIf="!isLoadingUsers">
          <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef>Username</th>
            <td mat-cell *matCellDef="let user">{{ user.username }}</td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let user">{{ user.email }}</td>
          </ng-container>

          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef>Role</th>
            <td mat-cell *matCellDef="let user">{{ user.role }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let user">
              <span *ngIf="user.banned" class="status-badge status-hidden">Banned</span>
              <span *ngIf="!user.banned" class="status-badge status-visible">Active</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Created</th>
            <td mat-cell *matCellDef="let user">{{ user.createdAt | date:'short' }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let user">
              <button mat-icon-button
                      [color]="user.banned ? 'primary' : 'warn'"
                      [matTooltip]="user.banned ? 'Unban user' : 'Ban user'"
                      (click)="user.banned ? unbanUser(user.id) : banUser(user.id)">
                <mat-icon>{{ user.banned ? 'person_add' : 'block' }}</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
        </table>
      </div>
    </mat-tab>

    <mat-tab label="Posts">
      <div class="tab-content">
        <mat-spinner *ngIf="isLoadingPosts"></mat-spinner>
        <table mat-table [dataSource]="posts" *ngIf="!isLoadingPosts">
          <ng-container matColumnDef="content">
            <th mat-header-cell *matHeaderCellDef>Content</th>
            <td mat-cell *matCellDef="let post" class="content-cell">{{ post.content }}</td>
          </ng-container>

          <ng-container matColumnDef="user">
            <th mat-header-cell *matHeaderCellDef>User</th>
            <td mat-cell *matCellDef="let post">{{ post.user?.username }}</td>
          </ng-container>

          <ng-container matColumnDef="likesCount">
            <th mat-header-cell *matHeaderCellDef>Likes</th>
            <td mat-cell *matCellDef="let post">{{ post.likesCount }}</td>
          </ng-container>

          <ng-container matColumnDef="commentsCount">
            <th mat-header-cell *matHeaderCellDef>Comments</th>
            <td mat-cell *matCellDef="let post">{{ post.commentsCount }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let post">
              <span *ngIf="post.hidden" class="status-badge status-hidden">Hidden</span>
              <span *ngIf="!post.hidden" class="status-badge status-visible">Visible</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Created</th>
            <td mat-cell *matCellDef="let post">{{ post.createdAt | date:'short' }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let post">
              <button mat-icon-button
                      [color]="post.hidden ? 'primary' : 'warn'"
                      [matTooltip]="post.hidden ? 'Unhide post' : 'Hide post'"
                      (click)="post.hidden ? unhidePost(post.id) : hidePost(post.id)">
                <mat-icon>{{ post.hidden ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deletePost(post.id)" matTooltip="Delete post">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="postColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: postColumns;"></tr>
        </table>
      </div>
    </mat-tab>

    <mat-tab label="Reports">
      <div class="tab-content">
        <mat-spinner *ngIf="isLoadingReports"></mat-spinner>
        <table mat-table [dataSource]="reports" *ngIf="!isLoadingReports">
          <ng-container matColumnDef="reporter">
            <th mat-header-cell *matHeaderCellDef>Reporter</th>
            <td mat-cell *matCellDef="let report">{{ report.reporter?.username }}</td>
          </ng-container>

          <ng-container matColumnDef="reportedUser">
            <th mat-header-cell *matHeaderCellDef>Reported User</th>
            <td mat-cell *matCellDef="let report">{{ report.reportedUser?.username }}</td>
          </ng-container>

          <ng-container matColumnDef="reason">
            <th mat-header-cell *matHeaderCellDef>Reason</th>
            <td mat-cell *matCellDef="let report" class="content-cell">{{ report.reason }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let report">
              <span class="status-badge" [class]="'status-' + report.status.toLowerCase()">
                {{ report.status }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Created</th>
            <td mat-cell *matCellDef="let report">{{ report.createdAt | date:'short' }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let report">
              <button mat-button (click)="updateReportStatus(report.id, 'REVIEWED')"
                      *ngIf="report.status === 'PENDING'">
                Review
              </button>
              <button mat-button (click)="updateReportStatus(report.id, 'RESOLVED')"
                      *ngIf="report.status === 'REVIEWED'">
                Resolve
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="reportColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: reportColumns;"></tr>
        </table>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
