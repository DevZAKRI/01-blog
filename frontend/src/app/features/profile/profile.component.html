<div class="profile-container" *ngIf="!isLoading && user">
  <div class="profile-header-card">
    <div class="profile-banner"></div>
    <div class="profile-content">
      <img [src]="user | avatar:'240x240'"
           alt="Profile Avatar"
           class="profile-avatar"
           (error)="onAvatarError($event, user)">
      <div class="profile-info">
        <div class="profile-name-section">
          <h1>{{ user.username }}</h1>
          <p class="full-name" *ngIf="user.fullName">{{ user.fullName }}</p>
        </div>
        <p class="bio" *ngIf="user.bio">{{ user.bio }}</p>
        <div class="profile-stats">
          <div class="stat">
            <span class="stat-value">{{ posts.length }}</span>
            <span class="stat-label">Posts</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ user.subscribersCount || 0 }}</span>
            <span class="stat-label">Followers</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ user.subscriptionsCount || 0 }}</span>
            <span class="stat-label">Following</span>
          </div>
        </div>
      </div>
      <div class="profile-actions">
        <button mat-raised-button color="primary" class="action-btn" (click)="onCreatePost()" *ngIf="isOwner">
          <mat-icon>add</mat-icon>
          Create Post
        </button>
        <button mat-raised-button
                class="action-btn follow-btn"
                [class.following]="isSubscribed"
                (click)="onSubscribe()"
                *ngIf="!isOwner">
          <mat-icon>{{ isSubscribed ? 'person_remove' : 'person_add' }}</mat-icon>
          {{ isSubscribed ? 'Following' : 'Follow' }}
        </button>
        <button mat-icon-button (click)="onReport()" *ngIf="!isOwner && user.role !== 'ADMIN'" class="report-btn" matTooltip="Report User">
          <mat-icon>flag</mat-icon>
        </button>
        <button mat-icon-button disabled *ngIf="!isOwner && user.role === 'ADMIN'" class="report-btn" matTooltip="Cannot report admins">
          <mat-icon>shield</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <div class="posts-section">
    <div class="section-header">
      <h2>Posts</h2>
      <span class="post-count">{{ posts.length }} {{ posts.length === 1 ? 'post' : 'posts' }}</span>
    </div>
    <div class="posts-list">
      <app-post-card
        *ngFor="let post of posts"
        [post]="post"
        (like)="onLike($event)"
        (comment)="onComment($event)"
        (delete)="onDelete($event)"
        (edit)="onEdit($event)">
      </app-post-card>

      <div class="empty-state" *ngIf="posts.length === 0">
        <mat-icon>article</mat-icon>
        <p>No posts yet</p>
        <p class="empty-subtitle" *ngIf="isOwner">Share your first learning journey</p>
        <p class="empty-subtitle" *ngIf="!isOwner">This user hasn't posted anything yet</p>
      </div>
    </div>
  </div>
</div>

<div class="loading-container" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
</div>
